<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø­ØµÙ† Ø§Ù„Ù…Ù…Ø§Ù„ÙŠÙƒ - v1.9</title>
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --deep-ebony: #0a0a0a;
            --stone-grey: #222222;
            --mamluk-gold: #c2a05d;
            --cairo-red: #7b1113;
            --parchment: #d9c5a3;
            --iron: #444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--deep-ebony);
            color: var(--parchment);
            font-family: 'Amiri', serif;
            height: 100vh;
            overflow: hidden;
        }

        /* --- THE GATE (HOME PAGE) --- */
        #castle-gate {
            position: fixed;
            inset: 0;
            background-color: var(--deep-ebony);
            background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px;
        }

        #castle-gate.opened { transform: scale(1.2); opacity: 0; pointer-events: none; }

        .gate-title {
            font-family: 'Reem Kufi', sans-serif;
            font-size: 2.8rem;
            color: var(--mamluk-gold);
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        .hall-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            max-width: 450px;
        }

        .gate-btn {
            background: var(--stone-grey);
            border: 1px solid var(--mamluk-gold);
            color: var(--parchment);
            padding: 18px 5px;
            font-family: 'Reem Kufi';
            font-size: 1rem;
            border-radius: 2px;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.7);
        }

        /* --- INTERIOR --- */
        header {
            background: #000;
            padding: 12px 20px;
            border-bottom: 2px solid var(--mamluk-gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 { font-family: 'Reem Kufi'; font-size: 1.3rem; margin: 0; color: var(--mamluk-gold); }

        /* The Mashrabiya / Window Icon */
        .icon-gate {
            font-size: 1.6rem;
            cursor: pointer;
            filter: sepia(1) saturate(2) hue-rotate(-10deg);
        }

        main {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            height: calc(100vh - 140px);
        }

        .hall-card {
            background: rgba(34, 34, 34, 0.8);
            border: 1px solid var(--iron);
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        input, select {
            width: 100%;
            background: #111;
            border: 1px solid var(--iron);
            color: var(--mamluk-gold);
            padding: 12px;
            margin: 8px 0;
            font-family: 'Amiri';
            font-size: 1rem;
        }

        .btn-action {
            background: var(--cairo-red);
            color: white;
            border: 1px solid var(--mamluk-gold);
            padding: 14px;
            width: 100%;
            font-family: 'Reem Kufi';
            font-size: 1.1rem;
            margin-top: 10px;
        }

        /* Clean Ledger - Reem Kufi for numbers, Amiri for text */
        .ledger-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 1rem;
        }

        .ledger-row strong { font-family: 'Reem Kufi'; color: var(--mamluk-gold); }

        nav {
            position: fixed;
            bottom: 0; width: 100%;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            background: #000;
            height: 75px;
            border-top: 2px solid var(--mamluk-gold);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-btn {
            background: none; border: none; color: #666;
            font-family: 'Reem Kufi'; font-size: 0.75rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .nav-btn.active { color: var(--mamluk-gold); }

        .tab-content { display: none; max-width: 600px; margin: 0 auto; }
        .active-content { display: block; }

        .vault-box {
            background: #000;
            padding: 15px;
            border: 1px solid var(--mamluk-gold);
            text-align: center;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div id="castle-gate">
    <div class="gate-title">Ø­ØµÙ† Ø§Ù„Ø°Ø§Øª</div>
    <div class="hall-grid">
        <div class="gate-btn" onclick="openGate('treasury', 'Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„')">ğŸª™ Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„</div>
        <div class="gate-btn" onclick="openGate('rituals', 'ØªÙ‡Ø°ÙŠØ¨ Ø§Ù„Ù†ÙØ³')">ğŸ•¯ï¸ ØªÙ‡Ø°ÙŠØ¨ Ø§Ù„Ù†ÙØ³</div>
        <div class="gate-btn" onclick="openGate('training', 'Ø³Ø§Ø­Ø© Ø§Ù„ÙØ±Ø³Ø§Ù†')">âš”ï¸ Ø³Ø§Ø­Ø© Ø§Ù„ÙØ±Ø³Ø§Ù†</div>
        <div class="gate-btn" onclick="openGate('library', 'Ø±ÙˆØ§Ù‚ Ø§Ù„Ø¹Ù„Ù…')">ğŸ“– Ø±ÙˆØ§Ù‚ Ø§Ù„Ø¹Ù„Ù…</div>
        <div class="gate-btn" onclick="openGate('chronicles', 'Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£ÙŠØ§Ù…')">ğŸ“œ Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£ÙŠØ§Ù…</div>
    </div>
</div>

<header>
    <div class="icon-gate" onclick="closeGate()">ğŸªŸ</div> <h1 id="hall-title">Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„</h1>
    <div style="width:30px;"></div>
</header>

<main>
    <section id="treasury" class="tab-content active-content">
        <div class="hall-card" style="text-align: center;">
            <span style="font-size: 0.8rem; opacity: 0.6;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…ØªØ§Ø­</span><br>
            <span id="total-gold" style="font-size: 2.8rem; color: var(--mamluk-gold); font-family: 'Reem Kufi';">0.00</span>
            
            <div class="vault-box">
                <span style="font-size: 0.8rem; color: var(--mamluk-gold);">ğŸ—ï¸ Ø§Ù„Ø®Ø¨ÙŠØ¦Ø© Ø§Ù„Ø³Ù„Ø·Ø§Ù†ÙŠØ©</span><br>
                <span id="vault-amount" style="filter: blur(8px); display:block; margin: 10px 0;" onclick="this.style.filter='none'">0.00</span>
                <button onclick="transferToVault()" style="background:none; border:1px solid var(--iron); color:var(--parchment); font-size:0.7rem; padding: 5px 10px;">Ù†Ù‚Ù„ Ù„Ù„Ø®Ø¨ÙŠØ¦Ø©</button>
            </div>
        </div>

        <div class="hall-card">
            <h2 style="font-family: 'Reem Kufi'; font-size: 1.1rem; margin-top:0;">ØªÙ‚ÙŠÙŠØ¯ Ù…Ø¹Ø§Ù…Ù„Ø©</h2>
            <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°Ù‡Ø¨ÙŠ" inputmode="decimal">
            <input type="text" id="note" placeholder="Ø¨ÙŠØ§Ù† Ø§Ù„Ù†ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„ØºÙ†ÙŠÙ…Ø©">
            <select id="category">
                <option value="Provisions">ğŸ— Ø§Ù„Ø£Ø±Ø²Ø§Ù‚</option>
                <option value="Gear">âš”ï¸ Ø§Ù„Ø¹ØªØ§Ø¯</option>
                <option value="Inn">ğŸ›– Ø§Ù„Ù†Ø²Ù„</option>
                <option value="Bounty">ğŸ’° Ø§Ù„ØºÙ†Ø§Ø¦Ù…</option>
            </select>
            <button class="btn-action" onclick="recordLoot()">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</button>
        </div>

        <div class="hall-card" style="background: #111;">
            <canvas id="treasuryChart" style="max-height: 220px;"></canvas>
        </div>

        <div id="ledger-list" style="padding-bottom: 80px;"></div>
    </section>

    <section id="rituals" class="tab-content"><h2>ØªÙ‡Ø°ÙŠØ¨ Ø§Ù„Ù†ÙØ³</h2></section>
    <section id="training" class="tab-content"><h2>Ø³Ø§Ø­Ø© Ø§Ù„ÙØ±Ø³Ø§Ù†</h2></section>
    <section id="library" class="tab-content"><h2>Ø±ÙˆØ§Ù‚ Ø§Ù„Ø¹Ù„Ù…</h2></section>
    <section id="chronicles" class="tab-content"><h2>Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£ÙŠØ§Ù…</h2></section>
</main>

<nav>
    <button class="nav-btn active" onclick="switchHall('treasury', 'Ø¨ÙŠØª Ø§Ù„Ù…Ø§Ù„', this)">ğŸª™<br>Ø§Ù„Ù…Ø§Ù„</button>
    <button class="nav-btn" onclick="switchHall('rituals', 'ØªÙ‡Ø°ÙŠØ¨ Ø§Ù„Ù†ÙØ³', this)">ğŸ•¯ï¸<br>Ø§Ù„Ù†ÙØ³</button>
    <button class="nav-btn" onclick="switchHall('training', 'Ø³Ø§Ø­Ø© Ø§Ù„ÙØ±Ø³Ø§Ù†', this)">âš”ï¸<br>Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</button>
    <button class="nav-btn" onclick="switchHall('library', 'Ø±ÙˆØ§Ù‚ Ø§Ù„Ø¹Ù„Ù…', this)">ğŸ“–<br>Ø§Ù„Ø±ÙˆØ§Ù‚</button>
    <button class="nav-btn" onclick="switchHall('chronicles', 'Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£ÙŠØ§Ù…', this)">ğŸ“œ<br>Ø§Ù„Ø£ÙŠØ§Ù…</button>
</nav>

<script>
    let transactions = JSON.parse(localStorage.getItem('mamluk_vault_v1.9')) || [];
    let vaultGold = parseFloat(localStorage.getItem('mamluk_secret_v1.9')) || 0;
    let myChart = null;

    function openGate(hallId, title) {
        document.getElementById('castle-gate').classList.add('opened');
        switchHall(hallId, title);
    }

    function closeGate() {
        document.getElementById('castle-gate').classList.remove('opened');
    }

    function switchHall(hallId, title, btn) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active-content'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(hallId).classList.add('active-content');
        document.getElementById('hall-title').innerText = title;
        if(btn) btn.classList.add('active');
        if(hallId === 'treasury') refreshTreasury();
    }

    function recordLoot() {
        const amt = document.getElementById('amount').value;
        if(!amt) return;
        transactions.unshift({
            id: Date.now(),
            amount: parseFloat(amt),
            note: document.getElementById('note').value || "ØºÙŠØ± Ù…Ø³Ù…Ù‰",
            category: document.getElementById('category').value,
            date: new Date().toLocaleDateString('ar-EG')
        });
        save();
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
        refreshTreasury();
    }

    function transferToVault() {
        const amt = parseFloat(prompt("Ù…Ø§ Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ù†Ù‚Ù„Ù‡ Ù„Ù„Ø®Ø¨ÙŠØ¦Ø©ØŸ"));
        if(!amt) return;
        transactions.unshift({ id: Date.now(), amount: -amt, note: "Ù†Ù‚Ù„ Ù„Ù„Ø®Ø¨ÙŠØ¦Ø© Ø§Ù„Ø³Ù„Ø·Ø§Ù†ÙŠØ©", category: "Vault" });
        vaultGold += amt;
        save();
        refreshTreasury();
    }

    function refreshTreasury() {
        const list = document.getElementById('ledger-list');
        list.innerHTML = '<h3 style="text-align:center; font-family: Reem Kufi; color:var(--mamluk-gold);">Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ§ÙˆÙŠÙ†</h3>';
        let total = 0;
        let cats = {};
        transactions.forEach(t => {
            total += t.amount;
            if(t.amount < 0) cats[t.category] = (cats[t.category] || 0) + Math.abs(t.amount);
            const row = document.createElement('div');
            row.className = 'ledger-row';
            row.innerHTML = `<span>${t.note}</span><strong>${t.amount.toFixed(2)}</strong>`;
            list.appendChild(row);
        });
        document.getElementById('total-gold').innerText = total.toFixed(2);
        document.getElementById('vault-amount').innerText = vaultGold.toFixed(2);
        updateChart(cats);
    }

    function updateChart(data) {
        const ctx = document.getElementById('treasuryChart').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(data),
                datasets: [{ data: Object.values(data), backgroundColor: ['#c2a05d','#7b1113','#444','#222'], borderWidth: 0 }]
            },
            options: { plugins: { legend: { labels: { color: '#d9c5a3', font: { family: 'Amiri' } } } } }
        });
    }

    function save() {
        localStorage.setItem('mamluk_vault_v1.9', JSON.stringify(transactions));
        localStorage.setItem('mamluk_secret_v1.9', vaultGold.toString());
    }

    refreshTreasury();
</script>
</body>
</html>
