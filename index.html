<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life System RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Almendra&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --parchment: #f4e4bc;
            --ink: #2c1e16;
            --iron: #4a4a4a;
            --gold: #c5a028;
            --blood: #8b0000;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Almendra', serif;
            background: #1a1a1a;
            color: var(--ink);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* The "Parchment" Container */
        #app-container {
            background-color: var(--parchment);
            background-image: url('https://www.transparenttextures.com/patterns/pinstriped-dark.png'); /* Subtle texture */
            flex: 1;
            margin: 10px;
            border: 8px solid var(--iron);
            border-image: linear-gradient(to bottom, #4a4a4a, #222) 1;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        h1, h2 { font-family: 'MedievalSharp', cursive; text-align: center; text-transform: uppercase; }

        /* Navigation Bar */
        nav {
            display: flex;
            background: var(--iron);
            justify-content: space-around;
            padding: 10px 0;
            border-top: 2px solid var(--gold);
        }

        nav button {
            background: none;
            border: none;
            color: #ccc;
            font-family: 'MedievalSharp', cursive;
            font-size: 0.7rem;
            cursor: pointer;
        }

        nav button.active { color: var(--gold); text-decoration: underline; }

        /* Treasury Styles */
        .tab-content { display: none; padding: 15px; }
        .tab-content.active { display: block; }

        .stat-card {
            background: rgba(0,0,0,0.05);
            border: 1px solid var(--ink);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .form-group { margin-bottom: 10px; }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            background: rgba(255,255,255,0.5);
            border: 1px solid var(--ink);
            box-sizing: border-box;
            font-family: 'Almendra', serif;
        }

        .btn-action {
            background: var(--ink);
            color: var(--parchment);
            width: 100%;
            padding: 10px;
            border: none;
            font-family: 'MedievalSharp', cursive;
            margin-top: 10px;
        }

        .log-item {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--ink);
            padding: 5px 0;
            font-size: 0.9rem;
        }

        canvas { max-width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="treasury" class="tab-content active">
        <h1>The Treasury</h1>
        
        <div class="stat-card">
            <div>Current Hoard: <strong id="total-gold">0.00</strong> Gold</div>
            <div style="font-size: 0.8rem; opacity: 0.7;">Bank: <span id="bank-val">0</span> | Cash: <span id="cash-val">0</span></div>
        </div>

        <div class="stat-card">
            <h2>Log New Loot/Tribute</h2>
            <div class="form-group">
                <input type="number" id="amount" placeholder="Amount (Gold)">
                <input type="text" id="note" placeholder="What was the quest?">
                <select id="category">
                    <option value="Provisions">Provisions (Food)</option>
                    <option value="Gear">Gear (Shopping)</option>
                    <option value="Inn">Inn (Rent/Bills)</option>
                    <option value="Bounty">Bounty (Income)</option>
                </select>
                <button class="btn-action" onclick="addTransaction()">Record in Ledger</button>
            </div>
        </div>

        <canvas id="treasuryChart"></canvas>

        <div id="ledger-list" style="margin-top: 20px;">
            <h3>Recent Ledger Entries</h3>
            </div>
    </div>

    <div id="habits" class="tab-content"><h1>Habit Tracker</h1><p>Daily Rituals go here...</p></div>
    <div id="gym" class="tab-content"><h1>Training Grounds</h1><p>Physical feats go here...</p></div>
    <div id="study" class="tab-content"><h1>The Library</h1><p>Ancient wisdom logs...</p></div>
    <div id="journal" class="tab-content"><h1>The Chronicles</h1><p>Dear Diary...</p></div>
</div>

<nav>
    <button onclick="showTab('treasury')" class="active">TREASURY</button>
    <button onclick="showTab('habits')">HABITS</button>
    <button onclick="showTab('gym')">GYM</button>
    <button onclick="showTab('study')">STUDY</button>
    <button onclick="showTab('journal')">JOURNAL</button>
</nav>

<script>
    // --- APP STATE ---
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let myChart = null;

    // --- NAVIGATION ---
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'treasury') updateUI();
    }

    // --- TREASURY LOGIC ---
    function addTransaction() {
        const amount = document.getElementById('amount').value;
        const note = document.getElementById('note').value;
        const cat = document.getElementById('category').value;
        
        if(!amount) return alert("How much gold, traveler?");

        const entry = {
            id: Date.now(),
            amount: parseFloat(amount),
            note: note,
            category: cat,
            date: new Date().toLocaleDateString()
        };

        transactions.unshift(entry);
        localStorage.setItem('transactions', JSON.stringify(transactions));
        
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
        updateUI();
    }

    function updateUI() {
        const list = document.getElementById('ledger-list');
        const totalEl = document.getElementById('total-gold');
        list.innerHTML = '<h3>Recent Ledger Entries</h3>';
        
        let total = 0;
        const totalsByCategory = {};

        transactions.forEach(t => {
            total += t.amount;
            totalsByCategory[t.category] = (totalsByCategory[t.category] || 0) + Math.abs(t.amount);
            
            const item = document.createElement('div');
            item.className = 'log-item';
            item.innerHTML = `<span>${t.date} - ${t.note}</span> <strong>${t.amount}g</strong>`;
            list.appendChild(item);
        });

        totalEl.innerText = total.toFixed(2);
        renderChart(totalsByCategory);
    }

    function renderChart(data) {
        const ctx = document.getElementById('treasuryChart').getContext('2d');
        if(myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    data: Object.values(data),
                    backgroundColor: ['#8b0000', '#c5a028', '#2c1e16', '#4a4a4a']
                }]
            },
            options: { 
                plugins: { legend: { labels: { color: '#2c1e16', font: { family: 'Almendra' } } } }
            }
        });
    }

    // Initialize
    updateUI();
</script>

</body>
</html>
